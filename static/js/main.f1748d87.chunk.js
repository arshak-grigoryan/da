(this.webpackJsonpda=this.webpackJsonpda||[]).push([[0],{24:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(17),c=n.n(a),i=(n(24),n(8)),o=n(4),u=n(0),l=n.n(u),p=n(3),d=n(19),h="AIzaSyDy6SRTXKsQx4TlXzxWw1LcN7OwiwwgtQM",f=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],g={recommended:{file:"https://www.googleapis.com/auth/drive.file",install:"https://www.googleapis.com/auth/drive.install"}},v=[g.recommended.file,g.recommended.install].join(" "),b="openWithAppSpecificDocument",k="openWithGoogleWorkspaceDocument",w="newButton",m="/chooser",x="/editor?category=photos",j={uploadUrl:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id",userIdFromDrive:null,uploadedImage:{id:null,webViewLink:null},openWithState:null,newButtonState:null,imgOptions:null,getImageById:function(e){return Object(p.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,gapi.client.drive.files.get({fileId:e,alt:"media",fields:"id, name"});case 3:return n=t.sent,t.abrupt("return","data:".concat(n.headers["Content-Type"],";base64, ").concat(btoa(n.body)));case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getFileFields:function(e,t){return Object(p.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,gapi.client.drive.files.get({fileId:e,fields:t});case 3:return r=n.sent,n.next=6,JSON.parse(r.body);case 6:return n.abrupt("return",n.sent);case 9:n.prev=9,n.t0=n.catch(0),console.log(n.t0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()},uploadFile:function(e){var t=this;return Object(p.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch(t.uploadUrl,{method:"POST",headers:new Headers({Authorization:"Bearer ".concat(gapi.auth.getToken().access_token)}),body:e});case 3:return r=n.sent,n.next=6,r.json();case 6:return n.abrupt("return",n.sent);case 9:n.prev=9,n.t0=n.catch(0),console.log(n.t0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()}},O=n(9),y=n(10),I=new(function(){function e(){Object(O.a)(this,e),e.apiKey=h,e.clientId="797908848155-g3s0vkl72b2hflvrq6mcq3et891evoim.apps.googleusercontent.com",e.discoverUrls=f,e.scopes=v}return Object(y.a)(e,[{key:"init",value:function(){var t=Object(p.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("gapi check"),!window.gapi){t.next=3;break}return t.abrupt("return");case 3:return console.log("gapi init"),t.prev=4,t.next=7,D("https://apis.google.com/js/api.js");case 7:return t.next=9,e.loadClient();case 9:return console.log("after load clint"),t.next=12,e.initClient();case 12:return console.log("after init client"),t.abrupt("return",gapi);case 16:t.prev=16,t.t0=t.catch(4),console.log(t.t0);case 19:case"end":return t.stop()}}),t,null,[[4,16]])})));return function(){return t.apply(this,arguments)}}()},{key:"signInWithGoogle",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.prev=2,e.next=5,gapi.auth2.getAuthInstance().signIn();case 5:return t=e.sent,e.abrupt("return",t);case 9:return e.prev=9,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"signOutGoogle",value:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:gapi.auth2.getAuthInstance().signOut();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"revokeAccess",value:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("revokeAccess"),e.next=3,this.init();case 3:gapi.auth2.getAuthInstance().disconnect();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shareDrive",value:function(){var t=Object(p.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init();case 2:return t.next=4,e.loadDriveShare();case 4:return console.log(j.uploadedImage.id),n=gapi.auth.getToken().access_token,t.next=8,new gapi.drive.share.ShareClient;case 8:window.s=t.sent,s.setOAuthToken(n),s.setItemIds(j.uploadedImage.id),s.showSettingsDialog();case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleDifferentUsers",value:function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getId()!==j.userIdFromDrive){e.next=2;break}return e.abrupt("return",this.handleGrantedScopes(t));case 2:return e.next=4,this.revokeAccess();case 4:if(!confirm("Your signed account ".concat(t.getBasicProfile().getEmail()," is not match with drive account, choose oter account"))){e.next=7;break}return e.abrupt("return",this.handleSignInPrompt());case 7:return e.abrupt("return",this.handleAuthorizeDriveModal());case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGrantedScopes",value:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.abrupt("return",gapi.auth2.getAuthInstance().currentUser.get().getGrantedScopes());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleGrantedScopes",value:function(t){for(var n=t.getGrantedScopes(),r=e.scopes.split(" "),a=0;a<r.length;a++)if(!n.includes(r[a]))return this.handleAuthorizeDriveModal();return t}},{key:"handleSignInPrompt",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.revokeAccess();case 2:return e.next=4,this.signInWithGoogle();case 4:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",this.handleDifferentUsers(t));case 7:return e.abrupt("return",this.handleAuthorizeDriveModal());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleAuthorizeDriveModal",value:function(){return confirm("Authorize Drive")?this.handleSignInPrompt():null}},{key:"authUser",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:if(t=gapi.auth2.getAuthInstance(),n=gapi.auth2.getAuthInstance().currentUser.get().getId(),console.log(n),!t.isSignedIn.get()){e.next=7;break}return e.abrupt("return",this.handleDifferentUsers(t.currentUser.get()));case 7:return e.abrupt("return",this.handleAuthorizeDriveModal());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"loadClient",value:function(){return new Promise((function(e,t){gapi.load("client:auth2",{callback:e,onerror:t})}))}},{key:"loadDriveShare",value:function(){return new Promise((function(e,t){gapi.load("drive-share",{callback:e,onerror:t})}))}},{key:"initClient",value:function(){return gapi.client.init({apiKey:e.apiKey,clientId:e.clientId,discoveryDocs:e.discoverUrls,scope:e.scopes})}}]),e}()),S=new(function(){function e(){Object(O.a)(this,e)}return Object(y.a)(e,[{key:"init",value:function(){var t=Object(p.a)(l.a.mark((function t(n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.authUser();case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return console.log("initPicker"),t.next=8,e.loadPicker();case 8:return t.next=10,e.createPicker(n);case 10:console.log("picker created");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"loadPicker",value:function(){return new Promise((function(e,t){gapi.load("picker",{callback:e,onerror:t})}))}},{key:"createPicker",value:function(){var t=Object(p.a)(l.a.mark((function t(n){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(n),r=gapi.auth.getToken().access_token,a=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setLabel("My Drive").setOwnedByMe(!0).setIncludeFolders(!0).setSelectFolderEnabled(!0),(new google.picker.PickerBuilder).addView(a).setOAuthToken(r).setDeveloperKey(h).setCallback((function(t){return e.pickerCallback(t,n)})).enableFeature(google.picker.Feature.SUPPORT_DRIVES).setTitle("Pick a folder").build().setVisible(!0);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"pickerCallback",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t),t[google.picker.Response.ACTION]===google.picker.Action.PICKED&&(r=t[google.picker.Response.DOCUMENTS][0],console.log(r),n(r.id));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),D=function(e){return new Promise((function(t){var n=document.createElement("script");n.src=e,n.onload=function(){t()},document.body.appendChild(n)}))},A=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,c,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.width,r=t.height,a=t.src,c=document.getElementById("myCanvas"),i=c.getContext("2d"),(o=new Image).src=a,o.onload=function(){c.width=n,c.height=r,i.drawImage(o,0,0)};case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,c,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={name:"0000hardCodeName",mimeType:j.imgOptions.mimeType,parents:[t],appProperties:{picsart:"PicsArt"}},console.log(n),r=j.imgOptions.src.split(",")[1],a=T(r,j.imgOptions.mimeType),(c=new FormData).append("metadata",new Blob([JSON.stringify(n)],{type:"application/json"})),c.append("file",a),console.log(c),e.next=10,j.uploadFile(c);case 10:return i=e.sent,console.log(i),j.uploadedImage.id=i.id,e.next=15,j.getFileFields(j.uploadedImage.id,"webViewLink");case 15:o=e.sent,j.uploadedImage.webViewLink=o.webViewLink,console.log(o),alert("Image Saved ".concat(j.uploadedImage.webViewLink));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S.init(C);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(e,t){for(var n=atob(e),r=[],a=new Array(n.length),c=0;c<n.length;c++)a[c]=n.charCodeAt(c);var i=new Uint8Array(a);return r.push(i),new Blob(r,{type:t})},F=function(){console.log("useGDrive");var e=Object(o.g)(),t=Object(o.f)();Object(r.useEffect)((function(){console.log("useGDrive eff");var n=new URLSearchParams(e.search);if(!n.has("state"))return null;var r=JSON.parse(n.get("state"));console.log(r);var a=function(e){var t=Object.keys(e),n=t.includes("userId"),r=t.includes("action"),a=t.includes("ids"),c=t.includes("exportIds"),i=t.includes("folderId");return n&&r&&a&&"open"===e.action?b:n&&r&&c&&"open"===e.action?k:n&&r&&i&&"create"===e.action?w:void 0}(r);console.log(a),a?Object(p.a)(l.a.mark((function e(){var n,c,i,o,s,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.init();case 2:return console.log(I),j.userIdFromDrive=r.userId,e.next=6,I.authUser();case 6:if(n=e.sent,console.log(n),n){e.next=11;break}return t.replace(x),e.abrupt("return");case 11:if(a!==b){e.next=29;break}return j.openWithState=r,c=j.openWithState.ids[0],j.uploadedImage.id=c,e.next=17,j.getFileFields(c,"*");case 17:if(i=e.sent){e.next=21;break}return t.replace(x),e.abrupt("return");case 21:return console.log(i),o=i.imageMediaMetadata,s=o.width,u=o.height,p=i.mimeType,e.next=25,j.getImageById(c);case 25:return d=e.sent,j.imgOptions={src:d,mimeType:p,width:s,height:u},A(j.imgOptions),e.abrupt("return");case 29:if(a!==k){e.next=31;break}return e.abrupt("return");case 31:if(a!==w){e.next=34;break}return j.newButtonState=r,e.abrupt("return");case 34:case"end":return e.stop()}}),e)})))():t.replace(m)}))},U=n(2),G=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];console.log(I);var c=function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I.shareDrive(),console.log(j);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.getGrantedScopes();case 2:t=e.sent,a(t.split(" ").filter((function(e){return e.includes("auth")})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)("div",{children:[Object(U.jsx)("button",{onClick:c,children:"Share Drive"}),Object(U.jsx)("button",{onClick:function(){I.authUser()},children:"Authorize"}),Object(U.jsx)("button",{onClick:function(){P()},children:"upload"}),Object(U.jsx)("button",{onClick:function(){I.signInWithGoogle()},children:"signIn"}),Object(U.jsx)("button",{onClick:function(){I.signOutGoogle()},children:"signOut"}),Object(U.jsx)("button",{onClick:function(){I.revokeAccess()},children:"revoke access"}),Object(U.jsx)("button",{onClick:i,children:"see granted scopes"})]}),n.map((function(e){return Object(U.jsx)("p",{children:e},e)})),Object(U.jsx)("div",{children:Object(U.jsx)("canvas",{id:"myCanvas"})})]})},B=function(){return Object(U.jsx)("div",{children:"hi"})},M=function(){return console.log("aa"),F(),Object(U.jsxs)("div",{children:[Object(U.jsx)(G,{}),Object(U.jsx)(o.c,{children:Object(U.jsx)(o.a,{exact:!0,path:"/",component:B})})]})};var z=function(){return Object(U.jsx)("div",{className:"App",children:Object(U.jsx)(i.a,{children:Object(U.jsx)(M,{})})})};c.a.render(Object(U.jsx)(z,{}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.f1748d87.chunk.js.map